#!/bin/sh

name=syncthing
org=derekschaefer
version=0.10.13
download=https://github.com/syncthing/syncthing/releases/download
dist=syncthing-linux-amd64-v$version

function clean() {
  rm -rf build config sync
}

function download() {
  clean
  mkdir -p build
  wget -O build/$name.tar.gz $download/v$version/$dist.tar.gz
  tar -xzf build/$name.tar.gz -C build
  cp build/$dist/syncthing build
}

function build() {
  download
  docker build -t $org/$name .
}

function push() {
  build
  docker push $org/$name
}

for cmd in ${@:1}; do
  eval $cmd
done
