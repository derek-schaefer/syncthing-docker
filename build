#!/bin/sh

name=syncthing
org=derekschaefer
version=0.10.21
url=https://github.com/syncthing/syncthing/releases/download
dist=syncthing-linux-amd64-v$version

function clean() {
  rm -rf dist config sync
}

function download() {
  mkdir -p dist
  curl -Lo dist/$name.tar.gz $url/v$version/$dist.tar.gz
  tar -xzf dist/$name.tar.gz -C dist
  cp dist/$dist/syncthing dist
}

function build() {
  docker build -t $org/$name .
}

function push() {
  docker push $org/$name
}

function all() {
  clean
  download
  build
}

for cmd in ${@:1}; do
  eval $cmd
done
